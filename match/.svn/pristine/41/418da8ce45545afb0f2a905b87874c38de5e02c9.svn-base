package com.dxtwangxiao.strongestsuperscholar.web.controller.system;

import com.alibaba.fastjson.JSONObject;
import com.dxtwangxiao.strongestsuperscholar.module.system.service.UserService;
import com.dxtwangxiao.strongestsuperscholar.web.dto.UserDTO;
import com.dxtwangxiao.strongestsuperscholar.web.util.WebUtil;
import com.dxtwangxiao.strongestsuperscholar.web.vo.RequestInfo;
import com.dxtwangxiao.strongestsuperscholar.web.vo.ResponseInfo;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import javax.servlet.http.HttpServletRequest;

/**
 * 用户控制器
 * <p>
 * Created by Devin
 * 2018-06-29 上午 10:48
 */
@RestController
@RequestMapping("/api/v1/sys/user")
public class UserController {

    @Autowired
    private UserService userService;

    @GetMapping("/{userId}")
    public ResponseInfo getUserInfo(@PathVariable("userId") String userId, HttpServletRequest request) {
        RequestInfo requestInfo = WebUtil.parseRequest(request);
        JSONObject jsonObject = new JSONObject();
        UserDTO userDTO = userService.getUserDTOById(userId);
        jsonObject.put("user", userDTO);
        return new ResponseInfo(requestInfo, jsonObject);
    }

    /**
     * 微信小程序，创建新用户
     *
     * @param requestInfo
     * @return
     */
    @PostMapping
    public ResponseInfo createNewUser(@RequestBody RequestInfo requestInfo) {
        JSONObject reqParam = requestInfo.getReqParam();
        String nickName = reqParam.getString("nickName");
        String avatarUrl = reqParam.getString("avatarUrl");
        String gender = reqParam.getString("gender");
        String city = reqParam.getString("city");
        String gradePhaseId = reqParam.getString("gradePhaseId");
        String gradeId = reqParam.getString("gradeId");

        JSONObject jsonObject = new JSONObject();
        UserDTO userDTO = userService.createUser(nickName, avatarUrl, gender, city, gradePhaseId, gradeId);
        jsonObject.put("user", userDTO);
        return new ResponseInfo(requestInfo, jsonObject);
    }
}
