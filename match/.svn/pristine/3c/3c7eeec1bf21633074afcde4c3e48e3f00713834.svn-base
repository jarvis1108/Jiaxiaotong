package com.dxtwangxiao.strongestsuperscholar.web.controller.question;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.dxtwangxiao.strongestsuperscholar.module.question.entity.QuestionMultipleChoice;
import com.dxtwangxiao.strongestsuperscholar.module.question.service.QuestionMultipleChoiceService;
import com.dxtwangxiao.strongestsuperscholar.web.util.WebUtil;
import com.dxtwangxiao.strongestsuperscholar.web.util.commconstant.CommConst;
import com.dxtwangxiao.strongestsuperscholar.web.vo.ErrorInfo;
import com.dxtwangxiao.strongestsuperscholar.web.vo.RequestInfo;
import com.dxtwangxiao.strongestsuperscholar.web.vo.ResponseInfo;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import javax.servlet.http.HttpServletRequest;
import java.util.List;

/**
 * @auther: shenhao
 * @descripition: 多选题控制器类
 * @date 2018\6\29 0029
 */
@RestController
@RequestMapping("/qst/QuestionMultipleChoice")
public class QuestionMultipleChoiceController {

    @Autowired
    private QuestionMultipleChoiceService questionMultipleChoiceService;

    /**
     *获取多选题列表
     * @param pageSize    页大小
     * @param currentPage 当前页数，从1开始
     * @param request     Http请求
     * @return
     */
    @GetMapping("/list")
    public ResponseInfo GetQuestionMultipleChoiceList(Integer pageSize, Integer currentPage, HttpServletRequest request)throws ErrorInfo {
        RequestInfo requestInfo=WebUtil.parseGetRequest(request);
        List<QuestionMultipleChoice> retList;
       if(pageSize == null || currentPage == null){
           retList=questionMultipleChoiceService.getAllQuestionMultipleChoice();
        }else if (pageSize <= 0 || currentPage <= 0){
           return new ResponseInfo(requestInfo, CommConst.ERR_REQ_PARAM.getCode(), CommConst.ERR_REQ_PARAM.getMessage(), null);
       }else{
            retList = questionMultipleChoiceService.getQuestionMultipleChoiceList(pageSize,currentPage);
        }

        return new ResponseInfo(requestInfo,retList);

    }

    /**
     * 编辑多选题信息
     * @param requestInfo 请求体中的请求信息
     * @return
     */

    @PostMapping("/edit")
    public ResponseInfo editQuestionMultipleChoice(@RequestBody RequestInfo requestInfo)throws ErrorInfo{
        JSONObject reqParams = requestInfo.getReqParam();
        if(reqParams.getString("questionId")==null){
            // 必须传入题目id
            return new ResponseInfo(requestInfo, CommConst.ERR_REQ_PARAM.getCode(), CommConst.ERR_REQ_PARAM.getMessage(), null);
        }
        QuestionMultipleChoice toUpdate = JSON.parseObject(reqParams.toJSONString(),QuestionMultipleChoice.class);
        QuestionMultipleChoice questionMultipleChoice = questionMultipleChoiceService.updateQuestionMultipleChoice(toUpdate);
        return new ResponseInfo(requestInfo,questionMultipleChoice);
    }
    /**
     * 添加多选题
     * @param requestInfo
     * @return
     * @throws ErrorInfo
     */
    @PostMapping("/add")
    public ResponseInfo addQuestionMultipleChoice(@RequestBody RequestInfo requestInfo)throws ErrorInfo{
        JSONObject reqParams = requestInfo.getReqParam();
        if(reqParams.getString("questionId")==null){
            return new ResponseInfo(requestInfo, CommConst.ERR_REQ_PARAM.getCode(), CommConst.ERR_REQ_PARAM.getMessage(), null);
        }
        QuestionMultipleChoice toAdd = JSON.parseObject(reqParams.toJSONString(),QuestionMultipleChoice.class);
        QuestionMultipleChoice questionMultipleChoice = questionMultipleChoiceService.create(toAdd);
        return new ResponseInfo(requestInfo,questionMultipleChoice);
    }

    /**
     * 根据questionId删除多选题
     * @param requestInfo
     * @return
     */
    @PostMapping("/rmQuestionMultipleChoice")
    public ResponseInfo deleteQuestionMultipleChoice(@RequestParam("questionId") String questionId,@RequestBody RequestInfo requestInfo)throws ErrorInfo{
        questionMultipleChoiceService.deleteQuestionMultipleChoiceByQuestionId(questionId);
        return new ResponseInfo(requestInfo, CommConst.ERR_SUCCESS.getCode(), CommConst.ERR_SUCCESS.getMessage(), null);
        }


}
