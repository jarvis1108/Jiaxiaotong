<template>
  <div class="st-background-base-div">
    <img class="st-background-bg-div" src="/static/images/bg.png" >
    
    
    <div id="st-status-text-div" v-show="isCreator">等待成员加入...</div>
    <div id="st-status-text-div" v-show="!isCreator">等待房主开局...</div>
    <!--
    	时间：2018-07-26
    	描述：成员头像
    -->
    <div id="st-players-list2-div">
      <img :class="bgStyle" src="/static/images/groupBattleWaiting/Headportrait_bg.png" class="st-background-bg-div"/>
      <div id="st-triangel-button2-div" @click="fold = !fold">
        <img :class="{'right':!fold,'bottom':fold}" src="/static/images/groupBattleWaiting/Rightarrow_icon.png" class="st-background-bg-div" />
      </div>
      <div id="st-player-image2-div" 
          v-if="!fold || (fold&&index<5)" v-for="(b,index) in playerList" 
          :class="{'slideIn':index >= 5 && !fold,'slideOut':index >= 5&& fold}" 
          :key="b"> <!--双行显示10个-->
        <img v-if="index===0" class="st-background-bg-div" :src="user.headImage"/>
        <img v-else class="st-background-bg-div" :src="b.headImage"/>
      </div>
    </div>
    
    <div id="st-host-logo-div">
      <img src="/static/images/groupBattleWaiting/Owner_icon.png" class="st-background-bg-div"/>
    </div>
    
    <div id="st-game-start-div" v-show="isCreator" v-if="playerNumber > 1">
      <img @click="on_startBattle" src="/static/images/groupBattleWaiting/Startthecompetition_btn.png" class="st-background-bg-div"/>
    </div>
    
    <div id="invite-div">
      <button :open-type="isShareable" class="invite">
          <img src="/static/images/groupBattleWaiting/Invitation_icon.png" class="invite_img"/>
      </button>  
      <span id="invite-text">邀请</span>
    </div>
  </div>
</template>

<script>
import wxs from "../utils/wx";
export default {
  props: {
    user: {
      type: Object,
      required: true
    },
    playerList: {
      type: Array,
      required: true
    },
    playerNumber: {
      type: Number,
      required: true
    },
    close: {
      type: Boolean,
      required: true
    },
    battleId: {
      required: true
    }
  },
  data() {
    return {
      waitOpponent: true, //是否处于等待状态
      isCreator: true,
      hostname: "",
      fold: true,
    };
  },
  computed:{
    //列表折叠、摊开动画效果
    'bgStyle'(){
      if(this.playerList.length > 5 && this.playerList.length <=10){
          return this.fold?'firstHide':'firstExtend';
      }else if(this.playerList.length > 10 && this.playerList.length <=15){
          return this.fold?'secondHide':'secondExtend';
      }else{
          return this.fold?'thirdHide':'thirdExtend';
      }
    },
    isShareable() {
      return this.playerNumber < 10? "share" : "";
    }
  },
  methods: {
    expand() {
      if (this.fold === true) {
        this.fold = false;
      } else if (this.fold === false) {
        this.fold = true;
      }
    },
    on_startBattle() {
      this.$emit("questionIndex");
      this.$emit("playerList", this.playerNumber);
      wx.sendSocketMessage({
        data: JSON.stringify({
          msgID: getuuid(),
          msgType: "A",
          msgData: {
            matchId: this.battleId,
            no: this.questionIndex
          },
          msgDesc: "请求出题"
        })
      });
    }
  }
}
</script>

<style scoped>
.st-background-base-div {
  width: 100%;
  height: 100%;
  position: fixed;
}
.st-background-bg-div {
  width: 100%;
  height: 100%;
  position: absolute;
}
#st-status-text-div {
  position: absolute;
  width: 100%;
  top: 11.77%;
  text-align: center;
  font-size: 36rpx;
  font-family: "PingFang-SC-Bold";
  color: rgb(255, 255, 255);
}
#st-players-list1-div {
  position: absolute;
  left: 4.67%;
  right: 4.67%;
  top: 18.91%;
  height: 10.28%;
}
#st-players-list2-div {
  position: absolute;
  left: 4.67%;
  right: 4.67%;
  top: 18.91%;
  height: 10.28%;
  /* height: 18.57%; */
}
.firstHide {
  animation: firstHide 0.5s forwards;
}
.secondHide {
  animation: secondHide 0.5s forwards;
}
.thirdHide {
  animation: thirdHide 0.5s forwards;
}
.firstExtend {
  animation: firstExtend 0.5s forwards;
}
.secondExtend {
  animation: secondExtend 0.5s forwards;
}
.thirdExtend {
  animation: thirdExtend 0.5s forwards;
}
.right{
  transform: rotate(90deg);
  transition: all .5s;
}
.bottom{
  transform: rotate(-90deg);
  transition: all .5s;
}
#st-triangel-button1-div {
  position: absolute;
  right: 4.71%;
  top: 43.55%;
  width: 4.51%;
  height: 17.71%;
}
#st-triangel-button2-div {
  position: absolute;
  right: 4.71%;
  top: 33.32%;
  width: 3.5%;
  height: 16.71%;
}
#st-game-start-div {
  position: absolute;
  top: 65.67%;
  left: 20.67%;
  right: 20.67%;
  height: 9.45%;
}
#st-player-image1-div {
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  margin-left: 5.88%;
  float: left;
  top: 17.74%;
  height: 64.52%;
  width: 11.76%;
  border-radius: 50%;
  /* background-color: rgb(132,132,132); */
  background-color: aqua;
}
#st-player-image2-div {
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  margin-left: 5.88%;
  margin-bottom: 40rpx;
  float: left;
  top: 9.82%;
  height: 40px;
  width: 11.76%;
  border-radius: 50%;
  overflow: hidden;
  background-color: aqua;
}
.slideIn {
  animation: slideIn 1s forwards;
}
.slideOut {
  animation: slideOut 1s forwards;
}
#st-host-logo-div {
  position: absolute;
  left: 17.73%;
  top: 20.23%;
  width: 4%;
  height: 2.49%;
  border-radius: 50%;
}
#invite-div {
  position: absolute;
  bottom: 20%;
  left: 40%;
  float: right;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: rgb(29, 218, 251);
  animation: shake 1.5s infinite;
}
.invite {
  border: 0 solid #000;
  background: transparent;
}

.invite::after {
  border: 0;
}
.invite_img {
  width: 30px;
  height: 30px;
  border: none;
}
#invite-text {
  font-size: 13px;
  font-weight: bold;
  color: white;
  position: absolute;
  left: 30%;
  top: 65%;
}
@keyframes shake {
  0%,
  100% {
    transform: rotate(0);
  }
  25%,
  75% {
    transform: translateX(0);
  }
  35%,
  45%,
  55%,
  65% {
    transform: translateX(-5px);
  }
  40%,
  50%,
  60%,
  70% {
    transform: translateX(5px);
  }
}
</style>