package com.dxtwangxiao.strongestsuperscholar.web.controller.scholarship;

import com.alibaba.fastjson.JSONObject;
import com.dxtwangxiao.strongestsuperscholar.module.wechat.service.WechatService;
import com.dxtwangxiao.strongestsuperscholar.web.util.WebUtil;
import com.dxtwangxiao.strongestsuperscholar.web.vo.RequestInfo;
import com.dxtwangxiao.strongestsuperscholar.web.vo.ResponseInfo;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.http.HttpServletRequest;

/**
 * Created by 孙伟浩 on 2018/9/18.
 */
@RestController
@RequestMapping("/api/v1/scholarship")
public class ScholarshipController {

    @Autowired
    private WechatService wechatService;

    @PostMapping
    public ResponseInfo saveScholarshipRecord(@RequestBody RequestInfo requestInfo, HttpServletRequest request) throws Exception{

        JSONObject reqParam = requestInfo.getReqParam();
        String openid = reqParam.getString("openid");
        String userId = reqParam.getString("userId");
        double amount = reqParam.getDouble("amount");
        String clientIp = WebUtil.getClientIp(request);

        Boolean result = wechatService.wxCorporatePay(openid, userId, clientIp, amount);
        if (result){
            return new ResponseInfo(requestInfo,new JSONObject());
        }
        return new ResponseInfo(requestInfo,"企业付款失败!");
    }
}
